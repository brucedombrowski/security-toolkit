{
  "$schema": "../schema.json",
  "title": "Security Verification Toolkit - Functional Requirements",
  "version": "1.0.0",
  "requirements": {
    "FR-001": {
      "title": "Malware Detection",
      "description": "The system shall scan target directories for known malware signatures using ClamAV.",
      "category": "Security Scanning",
      "priority": "HIGH",
      "nist_800_53": ["SI-3"],
      "nist_800_171": ["3.14.2"],
      "implementation": {
        "script": "check-malware.sh",
        "tests": ["tests/test-integration.sh"],
        "output": ".scans/malware-scan-*.txt"
      },
      "acceptance_criteria": [
        "Scan completes without error",
        "Known test malware patterns are detected",
        "Clean files do not trigger false positives",
        "Exit code 0 for clean, 1 for findings"
      ]
    },
    "FR-002": {
      "title": "PII Pattern Detection",
      "description": "The system shall scan files for personally identifiable information patterns including SSN, phone numbers, credit cards, and IP addresses.",
      "category": "Data Protection",
      "priority": "HIGH",
      "nist_800_53": ["SI-12"],
      "nist_800_171": [],
      "implementation": {
        "script": "check-pii.sh",
        "tests": ["tests/test-pii-patterns.sh", "tests/test-integration.sh"],
        "output": ".scans/pii-scan-*.txt"
      },
      "acceptance_criteria": [
        "Detects SSN patterns (XXX-XX-XXXX)",
        "Detects phone number patterns",
        "Detects credit card patterns",
        "Detects IPv4 address patterns",
        "Supports allowlist for false positives"
      ]
    },
    "FR-003": {
      "title": "Secrets Detection",
      "description": "The system shall scan source code for hardcoded credentials, API keys, private keys, and database connection strings.",
      "category": "Security Scanning",
      "priority": "CRITICAL",
      "nist_800_53": ["SA-11"],
      "nist_800_171": ["3.5.10"],
      "implementation": {
        "script": "check-secrets.sh",
        "tests": ["tests/test-secrets-patterns.sh", "tests/test-integration.sh"],
        "output": ".scans/secrets-scan-*.txt"
      },
      "acceptance_criteria": [
        "Detects AWS access keys",
        "Detects private key headers",
        "Detects password assignments",
        "Detects GitHub tokens",
        "Detects database connection strings",
        "Supports allowlist with SHA256 verification"
      ]
    },
    "FR-004": {
      "title": "MAC Address Detection",
      "description": "The system shall identify MAC addresses in files that could expose network topology information.",
      "category": "Data Protection",
      "priority": "MEDIUM",
      "nist_800_53": ["SC-8"],
      "nist_800_171": [],
      "implementation": {
        "script": "check-mac-addresses.sh",
        "tests": ["tests/test-mac-patterns.sh", "tests/test-integration.sh"],
        "output": ".scans/mac-address-scan-*.txt"
      },
      "acceptance_criteria": [
        "Detects colon-separated MACs (XX:XX:XX:XX:XX:XX)",
        "Detects dash-separated MACs (XX-XX-XX-XX-XX-XX)",
        "Detects Cisco format MACs (XXXX.XXXX.XXXX)",
        "Does not flag IPv6 addresses as false positives"
      ]
    },
    "FR-005": {
      "title": "Host System Inventory",
      "description": "The system shall collect comprehensive inventory of host system components including OS, hardware, network interfaces, and installed software.",
      "category": "Asset Management",
      "priority": "HIGH",
      "nist_800_53": ["CM-8"],
      "nist_800_171": ["3.4.1"],
      "implementation": {
        "script": "collect-host-inventory.sh",
        "tests": ["tests/test-inventory-modules.sh", "tests/test-integration.sh"],
        "output": ".scans/host-inventory-*.txt"
      },
      "acceptance_criteria": [
        "Collects OS version and kernel information",
        "Collects network interface details with MAC addresses",
        "Collects installed software packages with versions",
        "Collects security tool versions",
        "Output marked as CUI with handling instructions",
        "File permissions set to 600"
      ]
    },
    "FR-006": {
      "title": "Host Security Configuration Check",
      "description": "The system shall verify host security configuration settings against security baselines.",
      "category": "Configuration Management",
      "priority": "HIGH",
      "nist_800_53": ["CM-6"],
      "nist_800_171": ["3.4.2"],
      "implementation": {
        "script": "check-host-security.sh",
        "tests": ["tests/test-integration.sh"],
        "output": ".scans/host-security-scan-*.txt"
      },
      "acceptance_criteria": [
        "Checks SIP status on macOS",
        "Checks Gatekeeper status on macOS",
        "Checks FileVault encryption status",
        "Checks firewall status",
        "Provides PASS/FAIL for each check"
      ]
    },
    "FR-007": {
      "title": "Vulnerability Scanning",
      "description": "The system shall scan for network vulnerabilities and system security issues using Nmap and Lynis.",
      "category": "Vulnerability Management",
      "priority": "HIGH",
      "nist_800_53": ["RA-5", "SI-2", "SI-4", "CA-2"],
      "nist_800_171": ["3.11.2", "3.14.1", "3.14.6"],
      "implementation": {
        "script": "scan-vulnerabilities.sh",
        "tests": ["tests/test-scanner-modules.sh"],
        "output": ".scans/vulnerability-scan-*.txt"
      },
      "acceptance_criteria": [
        "Runs Nmap port scan on localhost",
        "Runs Lynis security audit",
        "Reports open ports with services",
        "Provides hardening recommendations",
        "Maps findings to NIST controls"
      ]
    },
    "FR-008": {
      "title": "NVD CVE Lookup",
      "description": "The system shall cross-reference installed software versions against the National Vulnerability Database to identify known CVEs.",
      "category": "Vulnerability Management",
      "priority": "HIGH",
      "nist_800_53": ["RA-5", "SI-2"],
      "nist_800_171": ["3.11.2", "3.11.3", "3.14.1"],
      "implementation": {
        "script": "check-nvd-cves.sh",
        "tests": ["tests/test-nvd-cves.sh"],
        "output": ".scans/nvd-cve-scan-*.txt"
      },
      "acceptance_criteria": [
        "Parses software from host inventory",
        "Queries NVD API for CVEs",
        "Reports CVSS scores and severity",
        "Supports offline mode with cache",
        "Maps packages to CPE format"
      ]
    },
    "FR-009": {
      "title": "CISA KEV Cross-Reference",
      "description": "The system shall cross-reference identified CVEs against the CISA Known Exploited Vulnerabilities catalog.",
      "category": "Threat Intelligence",
      "priority": "HIGH",
      "nist_800_53": ["RA-5", "SI-5"],
      "nist_800_171": ["3.11.2", "3.14.3"],
      "implementation": {
        "script": "check-kev.sh",
        "tests": [],
        "output": ".scans/kev-check-*.txt"
      },
      "acceptance_criteria": [
        "Downloads current KEV catalog",
        "Caches catalog with 24-hour TTL",
        "Matches CVEs against KEV entries",
        "Reports remediation due dates"
      ]
    },
    "FR-010": {
      "title": "Secure File Deletion",
      "description": "The system shall securely delete files using NIST SP 800-88 Clear method with verification.",
      "category": "Media Sanitization",
      "priority": "MEDIUM",
      "nist_800_53": ["MP-6"],
      "nist_800_171": ["3.8.9"],
      "implementation": {
        "script": "secure-delete.sh",
        "tests": ["tests/test-secure-delete.sh"],
        "output": null
      },
      "acceptance_criteria": [
        "Overwrites file content multiple times",
        "Supports recursive directory deletion",
        "Provides dry-run mode",
        "Requires force flag for actual deletion"
      ]
    },
    "FR-011": {
      "title": "Git History Purging",
      "description": "The system shall remove sensitive files from git history while preserving commit structure.",
      "category": "Data Protection",
      "priority": "MEDIUM",
      "nist_800_53": ["MP-6", "SI-12"],
      "nist_800_171": ["3.8.9"],
      "implementation": {
        "script": "purge-git-history.sh",
        "tests": ["scripts/test-git-purge-dry-run.sh"],
        "output": null
      },
      "acceptance_criteria": [
        "Provides dry-run mode showing affected files",
        "Requires explicit confirmation",
        "Creates backup before purging",
        "Logs actions to audit log"
      ]
    },
    "FR-012": {
      "title": "Consolidated Scan Report",
      "description": "The system shall orchestrate all scans and generate a consolidated security report.",
      "category": "Reporting",
      "priority": "HIGH",
      "nist_800_53": [],
      "nist_800_171": [],
      "implementation": {
        "script": "run-all-scans.sh",
        "tests": ["tests/test-run-all-scans.sh", "tests/test-integration.sh"],
        "output": ".scans/security-scan-report-*.txt"
      },
      "acceptance_criteria": [
        "Runs all security scans in sequence",
        "Generates host inventory first for reference",
        "Creates consolidated report with all findings",
        "Provides overall PASS/FAIL status",
        "Generates checksums for all outputs"
      ]
    },
    "FR-013": {
      "title": "PDF Attestation Generation",
      "description": "The system shall generate PDF attestation documents from scan results with NIST control mapping.",
      "category": "Reporting",
      "priority": "MEDIUM",
      "nist_800_53": [],
      "nist_800_171": [],
      "implementation": {
        "script": "generate-scan-attestation.sh",
        "tests": [],
        "output": ".scans/scan-attestation-*.pdf"
      },
      "acceptance_criteria": [
        "Generates PDF from LaTeX template",
        "Includes scan results summary",
        "Maps findings to NIST controls",
        "Includes toolkit version and commit hash",
        "Includes verification checksums"
      ]
    },
    "FR-014": {
      "title": "Audit Logging",
      "description": "The system shall maintain JSON Lines audit logs of all scan activities with timestamps and event details.",
      "category": "Audit",
      "priority": "HIGH",
      "nist_800_53": ["AU-2", "AU-3"],
      "nist_800_171": [],
      "implementation": {
        "script": null,
        "library": "lib/audit-log.sh",
        "tests": ["tests/test-audit-logging.sh", "tests/test-integration.sh"],
        "output": ".scans/audit-log-*.jsonl"
      },
      "acceptance_criteria": [
        "Records SCAN_START and SCAN_COMPLETE events",
        "Includes timestamp, hostname, username, PID",
        "Records individual findings",
        "Uses JSON Lines format for easy parsing"
      ]
    }
  }
}
